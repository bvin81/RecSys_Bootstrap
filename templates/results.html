<!-- ===== templates/results.html ===== -->
{% extends "base.html" %}

{% block title %}Aj√°nl√°sok - GreenRec{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>üå± Aj√°nlott receptek</h2>
        <p class="text-muted">Az al√°bbi receptek hasonl√≥ √∂sszetev≈ëket tartalmaznak √©s fenntarthat√≥s√°g szempontj√°b√≥l is j√≥k.</p>
        
        <div class="row">
            {% for recipe in recommendations %}
            <div class="col-12 mb-4">
                <div class="recipe-card">
                    <div class="row">
                        <div class="col-md-8">
                            <h5>{{ recipe.title }}</h5>
                            <p><strong>Kateg√≥ria:</strong> {{ recipe.category }}</p>
                            <p><strong>√ñsszetev≈ëk:</strong> {{ recipe.ingredients[:200] }}{% if recipe.ingredients|length > 200 %}...{% endif %}</p>
                            
                            {% if show_scores %}
                            <div class="mt-3">
                                <span class="badge bg-success score-badge">Eg√©szs√©g: {{ "%.1f"|format(recipe.hsi) }}</span>
                                <span class="badge bg-warning score-badge">K√∂rnyezet: {{ "%.1f"|format(recipe.esi) }}</span>
                                <span class="badge bg-info score-badge">N√©pszer≈±s√©g: {{ "%.1f"|format(recipe.ppi) }}</span>
                                <span class="badge bg-primary score-badge">√ñsszes: {{ "%.2f"|format(recipe.composite_score) }}</span>
                            </div>
                            {% endif %}
                            
                            {% if show_explanation and explanations[recipe.id] %}
                            <div class="explanation-box">
                                <strong>üí° Mi√©rt aj√°nljuk?</strong><br>
                                {{ explanations[recipe.id] }}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-success select-recipe-btn" 
                                    data-recipe-id="{{ recipe.id }}"
                                    data-recipe-title="{{ recipe.title }}">
                                Ezt v√°lasztom
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="text-center mt-4">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">√öj v√°laszt√°s</a>
        </div>
    </div>
</div>

<!-- V√°laszt√°s meger≈ës√≠t≈ë modal -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">V√°laszt√°s meger≈ës√≠t√©se</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Biztosan ezt a receptet v√°lasztod: <strong id="selected-recipe-title"></strong>?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">M√©gse</button>
                <button type="button" class="btn btn-success" id="confirm-selection">Igen, ezt v√°lasztom</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedRecipeId = null;

document.addEventListener('DOMContentLoaded', function() {
    const selectButtons = document.querySelectorAll('.select-recipe-btn');
    const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
    const confirmButton = document.getElementById('confirm-selection');
    const titleElement = document.getElementById('selected-recipe-title');
    
    selectButtons.forEach(button => {
        button.addEventListener('click', function() {
            selectedRecipeId = this.dataset.recipeId;
            titleElement.textContent = this.dataset.recipeTitle;
            modal.show();
        });
    });
    
    confirmButton.addEventListener('click', function() {
        if (selectedRecipeId) {
            // AJAX k√©r√©s a v√°laszt√°s r√∂gz√≠t√©s√©hez
            fetch('/select_recipe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    recipe_id: selectedRecipeId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    modal.hide();
                    // Siker√ºzenet megjelen√≠t√©se
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-success alert-dismissible fade show';
                    alert.innerHTML = `
                        K√∂sz√∂nj√ºk a v√°laszt√°st! A teszt eredm√©nyei seg√≠tenek az aj√°nl√≥rendszer fejleszt√©s√©ben.
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.querySelector('.container').insertBefore(alert, document.querySelector('.container').firstChild);
                    
                    // Gombok letilt√°sa
                    selectButtons.forEach(btn => {
                        btn.disabled = true;
                        btn.textContent = 'V√°laszt√°s r√∂gz√≠tve';
                        btn.classList.remove('btn-outline-success');
                        btn.classList.add('btn-success');
                    });
                }
            })
            .catch(error => {
                console.error('Hiba:', error);
                alert('Hiba t√∂rt√©nt a v√°laszt√°s r√∂gz√≠t√©se sor√°n.');
            });
        }
    });
});
</script>
{% endblock %}
