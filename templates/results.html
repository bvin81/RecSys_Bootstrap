{% extends "base.html" %}

{% block title %}üèÜ Az √ñn Eredm√©nyei - GreenRec{% endblock %}

{% block content %}
<div class="container">
    <!-- Fejl√©c -->
    <div class="header-section">
        <h1 class="page-title">
            üèÜ Az √ñn Eredm√©nyei
        </h1>
        <p class="page-subtitle">
            {{ get_group_name(user_summary.user_group) }} Csoport - Tanulm√°ny √ñsszefoglal√≥ja
        </p>
    </div>

    <!-- √ñsszefoglal√≥ k√°rty√°k -->
    <div class="summary-cards">
        <div class="summary-card completion">
            <div class="card-icon">
                {% if user_summary.study_completed %}
                <i class="fas fa-check-circle"></i>
                {% else %}
                <i class="fas fa-clock"></i>
                {% endif %}
            </div>
            <div class="card-content">
                <h3>Tanulm√°ny √Ållapota</h3>
                <p class="card-value">
                    {% if user_summary.study_completed %}
                    Befejezve ‚úÖ
                    {% else %}
                    Folyamatban ‚è≥
                    {% endif %}
                </p>
                <p class="card-detail">
                    {{ user_summary.current_round or 1 }}/{{ total_rounds }} k√∂r teljes√≠tve
                </p>
            </div>
        </div>

        <div class="summary-card ratings">
            <div class="card-icon">
                <i class="fas fa-star"></i>
            </div>
            <div class="card-content">
                <h3>√ñsszes √ârt√©kel√©s</h3>
                <p class="card-value">{{ user_summary.total_ratings or 0 }}</p>
                <p class="card-detail">
                    √Åtlag: {{ ((user_metrics.satisfaction or 0) * 5) | round_float(1) }}/5 ‚≠ê
                </p>
            </div>
        </div>

        <div class="summary-card performance">
            <div class="card-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="card-content">
                <h3>F1 Score</h3>
                <p class="card-value">{{ (user_metrics.f1_score or 0) | percentage }}</p>
                <p class="card-detail">
                    Aj√°nl√°si rendszer teljes√≠tm√©ny
                </p>
            </div>
        </div>

        <div class="summary-card time">
            <div class="card-icon">
                <i class="fas fa-stopwatch"></i>
            </div>
            <div class="card-content">
                <h3>Id≈ëtartam</h3>
                <p class="card-value">
                    {{ (user_summary.session_duration_minutes or 0) | round(0) }} perc
                </p>
                <p class="card-detail">
                    Akt√≠v r√©szv√©teli id≈ë
                </p>
            </div>
        </div>
    </div>

    <!-- R√©szletes metrik√°k -->
    <div class="detailed-metrics">
        <h2 class="section-title">
            üìä R√©szletes Teljes√≠tm√©ny Metrik√°k
        </h2>

        <div class="metrics-grid">
            <!-- Precision@5 -->
            <div class="metric-card">
                <div class="metric-header">
                    <h4>üéØ Precision@5</h4>
                    <span class="metric-help" title="Relev√°ns aj√°nl√°sok ar√°nya a top 5-ben">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </div>
                <div class="metric-visual">
                    <div class="progress-circle" data-percentage="{{ (user_metrics.precision_at_5 or 0) * 100 }}">
                        <span class="progress-text">{{ (user_metrics.precision_at_5 or 0) | percentage }}</span>
                    </div>
                </div>
                <p class="metric-description">
                    A top 5 aj√°nl√°sb√≥l h√°nyat √©rt√©kelt magasra (4-5 ‚≠ê)
                </p>
            </div>

            <!-- Recall@5 -->
            <div class="metric-card">
                <div class="metric-header">
                    <h4>üîÑ Recall@5</h4>
                    <span class="metric-help" title="Mennyire tal√°lta meg az √∂sszes relev√°ns receptet">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </div>
                <div class="metric-visual">
                    <div class="progress-circle" data-percentage="{{ (user_metrics.recall_at_5 or 0) * 100 }}">
                        <span class="progress-text">{{ (user_metrics.recall_at_5 or 0) | percentage }}</span>
                    </div>
                </div>
                <p class="metric-description">
                    Az √∂sszes kedvelt receptb≈ël mennyit tal√°lt meg a rendszer
                </p>
            </div>

            <!-- Diversity -->
            <div class="metric-card">
                <div class="metric-header">
                    <h4>üåà Diverzit√°s</h4>
                    <span class="metric-help" title="Aj√°nl√°sok v√°ltozatoss√°ga">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </div>
                <div class="metric-visual">
                    <div class="progress-circle" data-percentage="{{ (user_metrics.diversity_score or 0) * 100 }}">
                        <span class="progress-text">{{ (user_metrics.diversity_score or 0) | percentage }}</span>
                    </div>
                </div>
                <p class="metric-description">
                    Mennyire v√°ltozatosak voltak az aj√°nlott receptek
                </p>
            </div>

            <!-- Novelty -->
            <div class="metric-card">
                <div class="metric-header">
                    <h4>‚ú® √öjdons√°g</h4>
                    <span class="metric-help" title="Mennyire szokatlan recepteket tal√°lt">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </div>
                <div class="metric-visual">
                    <div class="progress-circle" data-percentage="{{ (user_metrics.novelty_score or 0) * 100 }}">
                        <span class="progress-text">{{ (user_metrics.novelty_score or 0) | percentage }}</span>
                    </div>
                </div>
                <p class="metric-description">
                    Mennyire √∫jszer≈± vagy kev√©sb√© ismert recepteket fedezett fel
                </p>
            </div>
        </div>
    </div>

    <!-- K√∂r√∂nk√©nti r√©szletez√©s -->
    <div class="round-breakdown">
        <h2 class="section-title">
            üîÑ K√∂r√∂nk√©nti Teljes√≠tm√©ny
        </h2>

        <div class="rounds-container">
            {% for round_num in range(1, total_rounds + 1) %}
            <div class="round-card {% if round_num <= (user_summary.current_round or 1) %}completed{% else %}pending{% endif %}">
                <div class="round-header">
                    <span class="round-number">{{ round_num }}</span>
                    <h4>{{ round_num }}. K√∂r</h4>
                    {% if round_num <= (user_summary.current_round or 1) %}
                    <span class="round-status completed">
                        <i class="fas fa-check"></i>
                    </span>
                    {% else %}
                    <span class="round-status pending">
                        <i class="fas fa-clock"></i>
                    </span>
                    {% endif %}
                </div>
                
                <div class="round-stats">
                    {% set round_ratings = user_summary.ratings_by_round.get('round_' + round_num|string, 0) %}
                    <div class="stat">
                        <span class="stat-label">√ârt√©kel√©sek:</span>
                        <span class="stat-value">{{ round_ratings }}</span>
                    </div>
                    
                    {% if round_num <= (user_summary.current_round or 1) and round_ratings > 0 %}
                    <div class="stat">
                        <span class="stat-label">√Ållapot:</span>
                        <span class="stat-value success">Teljes√≠tve</span>
                    </div>
                    {% elif round_num == (user_summary.current_round or 1) %}
                    <div class="stat">
                        <span class="stat-label">√Ållapot:</span>
                        <span class="stat-value current">Akt√≠v</span>
                    </div>
                    {% else %}
                    <div class="stat">
                        <span class="stat-label">√Ållapot:</span>
                        <span class="stat-value pending">V√°rakozik</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor
