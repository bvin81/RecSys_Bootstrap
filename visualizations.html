<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Vizualiz√°ci√≥s Dashboard - GreenRec</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .viz-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .chart-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .stats-highlight {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
        }
        
        .export-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .chart-nav {
            background: #e9ecef;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 20px;
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }
        
        .methodology-box {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Navig√°ci√≥ -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">üè† F≈ëoldal</a></li>
                <li class="breadcrumb-item"><a href="/stats">üìä Statisztik√°k</a></li>
                <li class="breadcrumb-item active">üìà Vizualiz√°ci√≥k</li>
            </ol>
        </nav>

        <!-- F≈ëc√≠m √©s √∂sszefoglal√≥ -->
        <div class="viz-card">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-3">üìä GreenRec Vizualiz√°ci√≥s Dashboard</h1>
                    <p class="lead">
                        Interakt√≠v grafikonok √©s statisztikai elemz√©sek a fenntarthat√≥s√°gi 
                        aj√°nl√≥rendszer A/B/C tesztj√©nek eredm√©nyeihez
                    </p>
                    <div class="methodology-box">
                        <strong>üî¨ Felhaszn√°lt m√≥dszertan:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>matplotlib</strong> - Alapvet≈ë grafikonok √©s hisztogramok</li>
                            <li><strong>seaborn</strong> - Statisztikai vizualiz√°ci√≥k (boxplot, violin plot)</li>
                            <li><strong>scipy</strong> - Statisztikai tesztek (Kruskal-Wallis, t-teszt)</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4">
                    {% if stats %}
                    <div class="stats-highlight">
                        <h3>{{ stats.total_choices or 0 }}</h3>
                        <p class="mb-1">√ñsszes v√°laszt√°s</p>
                        <small>{{ stats.total_groups or 0 }} akt√≠v tesztcsoport</small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Chart Navigation -->
        <div class="chart-nav">
            <ul class="nav nav-pills justify-content-center" id="chartTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="distribution-tab" data-bs-toggle="pill" 
                            data-bs-target="#distribution" type="button" role="tab">
                        üë• Csoporteloszl√°s
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="composite-tab" data-bs-toggle="pill" 
                            data-bs-target="#composite" type="button" role="tab">
                        üìà Kompozit Elemz√©s
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="breakdown-tab" data-bs-toggle="pill" 
                            data-bs-target="#breakdown" type="button" role="tab">
                        üîç HSI/ESI/PPI R√©szletek
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="timeline-tab" data-bs-toggle="pill" 
                            data-bs-target="#timeline" type="button" role="tab">
                        ‚è∞ Id≈ëbeli Trendek
                    </button>
                </li>
            </ul>
        </div>

        <!-- Chart Content -->
        <div class="tab-content" id="chartTabsContent">
            
            <!-- 1. Csoporteloszl√°s -->
            <div class="tab-pane fade show active" id="distribution" role="tabpanel">
                <div class="viz-card">
                    <h3>üë• A/B/C Tesztcsoportok Felhaszn√°l√≥i Eloszl√°sa</h3>
                    <p class="text-muted">
                        A randomiz√°lt csoportbeoszt√°s eredm√©nyei. Az egyenletes eloszl√°s biztos√≠tja 
                        a tesztek validit√°s√°t.
                    </p>
                    
                    {% if charts and charts.group_distribution %}
                    <div class="chart-container">
                        <img src="{{ charts.group_distribution }}" alt="Csoporteloszl√°s" class="chart-image">
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> 
                        Nincs elegend≈ë adat a csoporteloszl√°s megjelen√≠t√©s√©hez.
                    </div>
                    {% endif %}
                    
                    <div class="methodology-box">
                        <strong>üìä M√≥dszertan:</strong> Oszlopdiagram √©s k√∂rdiagram matplotlib haszn√°lat√°val. 
                        A randomiz√°ci√≥ sikeress√©g√©t vizu√°lisan is ellen≈ërizhetj√ºk.
                    </div>
                </div>
            </div>

            <!-- 2. Kompozit Elemz√©s -->
            <div class="tab-pane fade" id="composite" role="tabpanel">
                <div class="viz-card">
                    <h3>üìà Kompozit Pontsz√°mok Statisztikai Elemz√©se</h3>
                    <p class="text-muted">
                        A fenntarthat√≥s√°gi kompozit pontsz√°mok (HSI + ESI + PPI) eloszl√°sa √©s 
                        √∂sszehasonl√≠t√°sa a tesztcsoportok k√∂z√∂tt scipy statisztikai tesztekkel.
                    </p>
                    
                    {% if charts and charts.composite_analysis %}
                    <div class="chart-container">
                        <img src="{{ charts.composite_analysis }}" alt="Kompozit Elemz√©s" class="chart-image">
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> 
                        Nincs elegend≈ë v√°laszt√°si adat a kompozit elemz√©shez.
                    </div>
                    {% endif %}
                    
                    <div class="methodology-box">
                        <strong>üî¨ Statisztikai m√≥dszerek:</strong>
                        <ul class="mb-0">
                            <li><strong>Boxplot</strong> - Medi√°n, kvartilisek √©s outlier-ek megjelen√≠t√©se</li>
                            <li><strong>Violin plot</strong> - Teljes eloszl√°s s≈±r≈±s√©gf√ºggv√©nye</li>
                            <li><strong>Kruskal-Wallis teszt</strong> - Nem-parametrikus ANOVA (p < 0.05 szignifik√°ns)</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 3. HSI/ESI/PPI R√©szletek -->
            <div class="tab-pane fade" id="breakdown" role="tabpanel">
                <div class="viz-card">
                    <h3>üîç HSI/ESI/PPI Pontsz√°mok R√©szletes Bont√°sa</h3>
                    <p class="text-muted">
                        Az egyes fenntarthat√≥s√°gi dimenzi√≥k (eg√©szs√©g, k√∂rnyezet, n√©pszer≈±s√©g) 
                        k√ºl√∂n elemz√©se √©s korrel√°ci√≥s vizsg√°lat.
                    </p>
                    
                    {% if charts and charts.hsi_esi_ppi_breakdown %}
                    <div class="chart-container">
                        <img src="{{ charts.hsi_esi_ppi_breakdown }}" alt="HSI/ESI/PPI Bont√°s" class="chart-image">
                    </div>
                    {% else %}
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> 
                        Nincs elegend≈ë adat a r√©szletes bont√°shoz.
                    </div>
                    {% endif %}
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="methodology-box">
                                <strong>üçÉ HSI (Health Score Index):</strong><br>
                                Eg√©szs√©gess√©gi pontsz√°m (0-100)<br>
                                <em>Magasabb = eg√©szs√©gesebb</em>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="methodology-box">
                                <strong>üåç ESI (Environmental Score Index):</strong><br>
                                K√∂rnyezeti hat√°s pontsz√°m (0-255)<br>
                                <em>Alacsonyabb = k√∂rnyezetbar√°tabb</em>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="methodology-box">
                                <strong>‚≠ê PPI (Popularity Score Index):</strong><br>
                                N√©pszer≈±s√©gi pontsz√°m (0-100)<br>
                                <em>Magasabb = n√©pszer≈±bb</em>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. Id≈ëbeli Trendek -->
            <div class="tab-pane fade" id="timeline" role="tabpanel">
                <div class="viz-card">
                    <h3>‚è∞ V√°laszt√°si Mint√°k Id≈ëbeli Elemz√©se</h3>
                    <p class="text-muted">
                        A felhaszn√°l√≥i v√°laszt√°sok id≈ëbeli mint√°zatai √©s a kompozit pontsz√°mok 
                        trendjei a tesztel√©si folyamat sor√°n.
                    </p>
                    
                    {% if charts and charts.timeline_analysis %}
                    <div class="chart-container">
                        <img src="{{ charts.timeline_analysis }}" alt="Id≈ëbeli Trendek" class="chart-image">
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-clock"></i> 
                        Nincs elegend≈ë id≈ëbeli adat a trend elemz√©shez.
                    </div>
                    {% endif %}
                    
                    <div class="methodology-box">
                        <strong>üìà Id≈ëbeli elemz√©s:</strong> Mozg√≥√°tlag sz√°m√≠t√°s (rolling average) 
                        √©s hourly activity pattern. A trendek v√°ltoz√°sai jelezhetik a tanul√°si hat√°st.
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <h3 class="mb-4">üìÅ Adatok √©s Jelent√©sek Export√°l√°sa</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>üìä Vizu√°lis Exportok:</h5>
                    <p class="text-muted">Grafikonok let√∂lt√©se √©s megoszt√°sa</p>
                    <div class="d-flex flex-wrap gap-2">
                        <button onclick="downloadChart('group_distribution')" class="btn btn-outline-primary">
                            üë• Csoporteloszl√°s PNG
                        </button>
                        <button onclick="downloadChart('composite_analysis')" class="btn btn-outline-success">
                            üìà Kompozit Elemz√©s PNG
                        </button>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5>üìã Statisztikai Jelent√©sek:</h5>
                    <p class="text-muted">R√©szletes adatok √©s sz√°m√≠t√°sok</p>
                    <div class="d-flex flex-wrap gap-2">
                        <a href="/export/statistical_report" class="btn btn-warning" target="_blank">
                            üî¨ Teljes Statisztikai Jelent√©s JSON
                        </a>
                        <a href="/export/choices" class="btn btn-info">
                            üìã Nyers Adatok CSV
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-success mt-3">
                <h6 class="alert-heading">üí° Tipp a kutat√≥knak:</h6>
                <p class="mb-1">
                    <strong>JSON jelent√©s:</strong> Tartalmazza az √∂sszes scipy statisztikai teszt eredm√©ny√©t, 
                    le√≠r√≥ statisztik√°kat √©s p-√©rt√©keket.<br>
                    <strong>CSV export:</strong> Nyers adatok tov√°bbi elemz√©shez R, SPSS vagy Python pandas-szal.
                </p>
            </div>
        </div>

        <!-- Vissza navig√°ci√≥ -->
        <div class="text-center">
            <a href="/stats" class="btn btn-secondary btn-lg">
                ‚Üê Vissza a Statisztik√°khoz
            </a>
            <a href="/" class="btn btn-success btn-lg">
                üè† F≈ëoldal
            </a>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">Grafikon gener√°l√°sa folyamatban...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Chart download functionality
        function downloadChart(chartType) {
            const modal = new bootstrap.Modal(document.getElementById('loadingModal'));
            modal.show();
            
            fetch(`/charts/${chartType}`)
                .then(response => response.json())
                .then(data => {
                    modal.hide();
                    if (data.chart) {
                        // Base64 image download
                        const link = document.createElement('a');
                        link.href = data.chart;
                        link.download = `greenrec_${chartType}_${new Date().toISOString().split('T')[0]}.png`;
                        link.click();
                    } else {
                        alert('Hiba a grafikon gener√°l√°sa sor√°n');
                    }
                })
                .catch(error => {
                    modal.hide();
                    alert('Hiba: ' + error.message);
                });
        }
        
        // Auto-refresh functionality (optional)
        function refreshCharts() {
            if (confirm('Friss√≠ts√ºk a grafikonokat a legfrissebb adatokkal?')) {
                location.reload();
            }
        }
        
        // Tab change analytics (optional)
        document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
            tab.addEventListener('shown.bs.tab', function(e) {
                console.log('Tab switched to:', e.target.id);
                // Itt lehetne analytics event k√ºldeni
            });
        });
        
        // Tooltip initialization for methodology boxes
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
</body>
</html>
